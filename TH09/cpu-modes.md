
<!-- TOC depthFrom:1 depthTo:3 insertAnchor:false orderedList:false -->

- [CPUの弾避けモード](#cpuの弾避けモード)
  - [タイマーの挙動](#タイマーの挙動)
  - [擬似コード](#擬似コード)
  - [おまけ: CPUレベルの表](#おまけ-cpuレベルの表)

<!-- /TOC -->

----

これで値の動きを観察すると理解が深まるかと思います。
- [./th09_CPUTimers.CT](./th09_CPUTimers.CT) - [Cheat Engine](https://www.cheatengine.org/)
- 参考
  - CPUレベルの表: https://docs.google.com/spreadsheets/d/1utEU1_XsPu7yVPxS6dafUcBP2cDpnnWZ2fAVDZqL09w/edit?usp=sharing
  - 各ステージのCPUレベル: [ＣＰＵレベルとタイマー - th09 - atwiki（アットウィキ）](https://w.atwiki.jp/th09/pages/33.html)

ていうかぶっちゃけ下の文章が正しい自信がない。

----

[DEHANA p.97 CPUの弾避けモード](https://drive.google.com/file/d/1d8FydjoZqTmshlMux8LY25mMJkVgstwn/view?usp=drive_link)を下敷きにしつつ一部表現を変更したりしてます。

# CPUの弾避けモード

- CPUの弾避けモードには三つの段階がある。
- 「詰みクイックモード」で始まり、時間経過によって「詰み被弾モード」、更に時間が経過すると「棒立ちモード」に移行する。被弾すると最初の「詰みクイックモード」に戻る。
- 「詰みクイックモード」と「詰み被弾モード」の持続時間は、CPUレベル及び現在のライフが「5.0」「4.5~1.0」「0.5」のどの範囲内にあるかによって決まる。
  - また、底上げダメージもCPUレベルによって決まる。

|モード|弾避け|被弾直前にクイック|備考|
|---|---|---|---|
|第1段階: 詰みクイック|する|撃つ|ゲージ2本未満で詰んだ時のみ被弾する。マッチルナCPUは常にこの状態。|
|第2段階: 詰み被弾|する|撃たない|詰んだらゲージが2本以上あっても被弾する。|
|第3段階: 棒立ち|しない|撃たない|いわゆる棒立ちモード。|

※弾避けする/しない、クイック撃つ/撃たないの他にも違いがあるかもしれない。

## タイマーの挙動

| |カットイン|時間停止|それ以外|
|---|---|---|---|
|詰みクイック無効化タイマー|進まない|進まない|進む|
|棒立ち化タイマー|進まない|進まない|進む|
|0hitタイマー|進まない|進む|進む|

- 「詰みクイックモード」から「詰み被弾モード」への移行を制御するタイマーを「詰みクイック無効化タイマー」と呼ぶ。
- 「詰み被弾モード」から「棒立ちモード」への移行を制御するタイマーを「棒立ち化タイマー」と呼ぶ。
- 詰みクイック無効化タイマーも棒立ち化タイマーもカットイン中と時間停止中は止まるため、CPUの耐久時間の計算がしにくい。
- 詰みクイック無効化タイマーは、CPUの対戦相手(つまりストーリーモードではプレイヤー)のHit数0の状態が6秒以上続くと進まなくなる(0hitタイマーで制御)。
- 棒立ち化タイマーは、詰みクイック無効化タイマーと違ってHit数0状態が何秒持続しようが進み続ける。
- 棒立ちモードでは、Hit数0状態が5秒以上続くと一時的に詰み被弾モードに戻る。Hit数が0でなくなれば、すぐに棒立ちモードに戻る。

## 擬似コード

```
function CPUの弾避けモード設定 ()
{
  if (ラウンド開始 || CPU被弾) {
    モード = 詰みクイック;
  } else if (詰みクイック無効化タイマー >= 詰みクイックモードの持続時間) {
    モード = 詰み被弾;
  } else if (棒立ち化タイマー >= 詰み被弾モードの持続時間) {
    モード = 棒立ち;
  }

function CPUの被弾タイマー進行 ()
  if (カットイン中 || 時間停止中) {
    タイマー進行しない;
  } else if (モード == 詰みクイック) {
    if (0Hit持続時間 < 6秒)
      詰みクイック無効化タイマー進行;
  } else if (モード == 詰み被弾) {
    棒立ち化タイマー進行;
  } else {
    if (0Hit持続時間 >= 5秒)
      モード = 一時的な詰み被弾;
    else
      モード = 棒立ち;
  }
}
```

## おまけ: CPUレベルの表
|CPUレベル|ライフ5.0-A|ライフ5.0-B|ライフ4.5~1.0-A|ライフ4.5~1.0-B|ライフ0.5-A|ライフ0.5-B|底上げダメージ|
|:---:|---:|---:|---:|---:|---:|---:|---:|
|**0**|0|0|0|5|0|10|1.5|
|**1**|0|0|0|6|0|10|1.5|
|**2**|0|0|0|7|0|15|1.5|
|**3**|0|0|0|8|0|15|1.5|
|**4**|0|0|0|9|0|15|1.5|
|**5**|0|0|0|10|10|10|1.5|
|**6**|0|0|0|10|10|10|1.5|
|**7**|0|0|0|10|10|15|1.5|
|**8**|0|0|0|15|10|15|1.5|
|**9**|0|0|0|15|10|20|1.5|
|**10**|10|5|5|10|10|10|1.0|
|**11**|10|5|5|10|10|10|1.0|
|**12**|10|5|5|10|10|15|1.0|
|**13**|10|5|5|15|10|15|1.0|
|**14**|10|5|5|15|10|20|1.0|
|**15**|10|5|5|10|15|10|1.0|
|**16**|10|5|5|10|15|10|1.0|
|**17**|10|5|5|10|15|15|1.0|
|**18**|10|5|5|15|15|15|1.0|
|**19**|10|5|5|15|15|20|1.0|
|**20**|15|25|10|10|20|20|0.5|
|**21**|15|30|10|10|20|20|0.5|
|**22**|15|30|10|10|20|25|0.5|
|**23**|15|30|10|15|20|25|0.5|
|**24**|15|30|10|15|20|30|0.5|
|**25**|20|25|10|10|20|20|0.5|
|**26**|20|30|10|10|20|20|0.5|
|**27**|20|30|10|10|20|25|0.5|
|**28**|20|30|10|15|20|25|0.5|
|**29**|20|30|10|15|20|30|0.5|
|**30**|20|25|15|10|30|20|0.0|
|**31**|20|30|15|10|30|20|0.0|
|**32**|20|30|15|10|30|25|0.0|
|**33**|20|30|15|15|30|25|0.0|
|**34**|20|30|15|15|30|30|0.0|
|**35**|20|25|15|20|30|20|0.0|
|**36**|20|30|15|20|30|20|0.0|
|**37**|20|30|15|20|30|25|0.0|
|**38**|20|30|15|25|30|25|0.0|
|**39**|20|30|15|25|30|30|0.0|
|**40**|30|25|20|10|50|20|0.0|
|**41**|30|30|20|10|50|20|0.0|
|**42**|30|30|20|10|50|25|0.0|
|**43**|30|30|20|10|50|25|0.0|
|**44**|30|30|20|10|50|30|0.0|
|**45**|30|25|20|10|60|20|0.0|
|**46**|30|30|20|10|60|20|0.0|
|**47**|30|30|20|10|60|25|0.0|
|**48**|30|30|20|10|60|25|0.0|
|**49**|30|30|20|10|60|30|0.0|
|**50**|40|25|20|10|60|20|0.0|
|**51**|40|30|20|10|60|20|0.0|
|**52**|40|30|20|10|70|20|0.0|
|**53**|40|30|20|10|70|20|0.0|
|**54**|40|30|20|10|70|20|0.0|
|**55**|50|25|20|10|80|20|0.0|
|**56**|50|30|20|10|90|20|0.0|
|**57**|50|30|20|10|100|20|0.0|
|**58**|50|30|20|10|110|20|0.0|
|**59**|50|30|20|10|120|20|0.0|
|**60**|9999999|9999999|9999999|9999999|9999999|9999999|0.0|
|**61**|20|20|30|20|20|0|0.0|
|**62**|20|20|30|20|22|0|0.0|
|**63**|20|23|30|20|24|0|0.0|
|**64**|25|23|30|25|26|0|0.0|
|**65**|40|25|30|25|28|0|0.0|
|**66**|45|25|30|10|40|0|0.0|
|**67**|50|10|30|10|45|0|0.0|
|**68**|60|10|30|10|50|0|0.0|
|**69**|70|10|30|15|55|0|0.0|
|**70**|70|10|30|15|120|0|0.0|
